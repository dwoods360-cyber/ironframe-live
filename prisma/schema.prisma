datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

generator client {
  provider = "prisma-client-js"
}

// --- AGENT WORKFORCE ENUMS ---
enum RiskTier {
  CRITICAL
  HIGH
  MED
  LOW
}

enum AgentStatus {
  ONLINE
  OFFLINE
  THINKING
  ERROR
}

// ------------------------------------------------------
// THE TENANT BOUNDARY (The Client Organizations)
// ------------------------------------------------------
model Company {
  id                       BigInt       @id @default(autoincrement())
  name                     String
  sector                   String
  industry_avg_loss_cents  BigInt?      // Refactored: Stored in exact cents
  infrastructure_val_cents BigInt?      // Refactored: Stored in exact cents

  departments              Department[]
  policies                 Policy[]
  risks                    ActiveRisk[]
  vendors                  Vendor[]

  @@map("companies")
}

// ------------------------------------------------------
// INTERNAL DIVISIONS
// ------------------------------------------------------
model Department {
  id         BigInt   @id @default(autoincrement())
  company_id BigInt
  name       String   // e.g., "IT", "Finance", "HR"
  
  company    Company  @relation(fields: [company_id], references: [id], onDelete: Cascade)

  @@map("departments")
}

// ------------------------------------------------------
// THE AGENT WORKFORCE TARGETS
// ------------------------------------------------------
model Policy {
  id         BigInt   @id @default(autoincrement())
  company_id BigInt
  name       String
  status     String   // 'COMPLIANT' or 'GAP DETECTED'
  last_scan  String   @default("Today")
  
  company    Company  @relation(fields: [company_id], references: [id], onDelete: Cascade)

  @@map("policies")
}

model ActiveRisk {
  id         BigInt   @id @default(autoincrement())
  company_id BigInt
  title      String
  status     String
  score      Float
  source     String   // e.g., 'IronSight', 'CoreIntel'
  
  company    Company  @relation(fields: [company_id], references: [id], onDelete: Cascade)

  @@map("active_risks")
}

// ------------------------------------------------------
// SUPPLY CHAIN (TPRM / VRM) - Agent 10 Targets
// ------------------------------------------------------
model Vendor {
  id              BigInt       @id @default(autoincrement())
  company_id      BigInt       // Strict boundary: Only the Tenant sees this vendor
  name            String
  risk_tier       RiskTier     @default(LOW)
  
  // N-Tier Supply Chain Mapping (Agent 10 / Ironmap)
  parent_id       BigInt?      // If populated, this is a 4th+ party
  parent          Vendor?      @relation("SupplyChain", fields: [parent_id], references: [id])
  sub_processors  Vendor[]     @relation("SupplyChain")

  company         Company      @relation(fields: [company_id], references: [id], onDelete: Cascade)

  @@map("vendors")
}