datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

generator client {
  provider = "prisma-client-js"
}

// --- AGENT WORKFORCE ENUMS ---
enum RiskTier {
  CRITICAL
  HIGH
  MED
  LOW
}

enum AgentStatus {
  ONLINE
  OFFLINE
  THINKING
  ERROR
}

// ------------------------------------------------------
// THE TENANT BOUNDARY (The Client Organizations)
// ------------------------------------------------------
model Company {
  id                 BigInt       @id @default(autoincrement())
  name               String
  sector             String
  industry_avg_loss  String?
  infrastructure_val String?
  
  departments        Department[]
  policies           Policy[]
  risks              ActiveRisk[]

  @@map("companies")
}

// ------------------------------------------------------
// INTERNAL DIVISIONS
// ------------------------------------------------------
model Department {
  id         BigInt   @id @default(autoincrement())
  company_id BigInt
  name       String   // e.g., "IT", "Finance", "HR"
  
  company    Company  @relation(fields: [company_id], references: [id], onDelete: Cascade)

  @@map("departments")
}

// ------------------------------------------------------
// THE AGENT WORKFORCE TARGETS
// ------------------------------------------------------
model Policy {
  id         BigInt   @id @default(autoincrement())
  company_id BigInt
  name       String
  status     String   // 'COMPLIANT' or 'GAP DETECTED'
  last_scan  String   @default("Today")
  
  company    Company  @relation(fields: [company_id], references: [id], onDelete: Cascade)

  @@map("policies")
}

model ActiveRisk {
  id         BigInt   @id @default(autoincrement())
  company_id BigInt
  title      String
  status     String
  score      Float
  source     String   // e.g., 'IronSight', 'CoreIntel'
  
  company    Company  @relation(fields: [company_id], references: [id], onDelete: Cascade)

  @@map("active_risks")
}