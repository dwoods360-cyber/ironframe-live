// This is your Ironframe Foundation
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum RiskTier {
  CRITICAL
  HIGH
  MED
  LOW
}

enum AgentStatus {
  ONLINE
  OFFLINE
  THINKING
  ERROR
}

model Tenant {
  id                String   @id @default(cuid())
  name              String   // e.g., "Medshield", "Vaultbank"
  industry          String
  ale_baseline      Float    // e.g., 11100000 for Medshield
  vendors           Vendor[]
  agent_logs        AgentLog[]
  createdAt         DateTime @default(now())
}

model Vendor {
  id                String   @id @default(cuid())
  tenantId          String
  tenant            Tenant   @relation(fields: [tenantId], references: [id])
  name              String
  riskTier          RiskTier @default(LOW)
  healthScore       Int      @default(100)
  lastAuditDate     DateTime?
  soc2Expiration    DateTime?
  isQuarantined     Boolean  @default(false)
  
  // N-Tier Dependency Mapping for Agent 10
  parentId          String?
  parent            Vendor?  @relation("SubProcessors", fields: [parentId], references: [id])
  subProcessors     Vendor[] @relation("SubProcessors")

  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

model AgentLog {
  id                String   @id @default(cuid())
  tenantId          String
  tenant            Tenant   @relation(fields: [tenantId], references: [id])
  agentId           Int      // 1-12 based on your workforce manifest
  agentName         String   // e.g., "IRONSIGHT", "COREINTEL"
  message           String
  severity          String   // "INFO", "WARN", "CRITICAL"
  payload           Json?    // For storing CVE IDs or specific audit findings
  timestamp         DateTime @default(now())
}